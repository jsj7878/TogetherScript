# 12장 (타입 스크립트 프로젝트 관리)

## 12.1 앰비언트 타입 활용하기

- 앰비언트 타입
    - .d.ts 확장자를 가진 파일에서 하는 타입 선언
    - 타입 선언만 할 수 있으며 값을 표현할 수는 없다.
    - 앰비언트 타입 선언으로는 값을 정의할 수 없지만 declare라는 키워드르 사용하여 어딘가에 자바 스크립트 값이 존재한다는 사실을 선언 할 수 있다.
    - 타입 스크립트는 기본적으로 .ts, .js 파일만 이해하며 그 이외의 파일 형식은 인식하지 못한다. 따라서 알지 못하는 파일 형식을 모듈로 가져오려면 에러가 발생한다.
    - declare 키워드를 사용하여 아래와 같이 특정 형식을 모듈로 선언하고 타입 스크립트 컴파일러에 미리 정보를 제공하여 에러를 수정할 수 있게 한다.
        
        ```tsx
        declare module "*.png" {
        	const src: string;
        	export default src;
        }
        ```
        
    - declare 키워드는 이미 존재하지만 타입 스크립트가 알지 못하는 부분을 컴파일러에게 알려주는 역할을 한다.
    - 앰비언트 타입 활용 사례
    - (우정이네 앰비언트 타입을 써본적이 있나?)
        - 자바스크립트로 구성된 라이브러리
            - 자바 스크립트로 구성된 라이브러리의 경우 자바 스크립트라서 타입 선언이 존재하지 않는다. 따라서 타입 스크립트에서는 이 라이브러리를 사용할 순 있지만 타입 선언이 없기 때문에 임포트한 모듈을 모두 any로 추론한다. 이렇게 될 경우, any를 사용하지 못하게 했다면 프로젝트가 빌드가 되지 않는다..
            - 이럴 때 앰비언트 타입 선언을 통해 자바 스크립트 라이브러리 내부 함수와 변수 타입을 앰비언트 타입으로 선언하여 타입 검사를 진행하고 컴파일 하자.
            - 앰비언트 타입 선언은 타입 스크립트에게 ‘자바 스크립트 코드 안에는 이러한 정보들이 있다’ 라고 알려주는 도구이다.
        - 타입 스크립트로 구성된 라이브러리
            - 타입 스크립트로 구성된 라이브러리도 자바 스크립트 파일과 .d.ts 파일로 배포되는 것이 일반적이다. 이 경우 타입 스크립트를 컴파일 할 때 라이브러리 코드를 따로 컴파일하지 않아도 되기 때문에 컴파일 시간이 크게 줄어든다.
            - 또한 사용자가 .d.ts 파일에 정의된 타입 정보를 활용하여 라이브러리를 사용할 수 있다.
        - 자바 스크립트 어딘가에 전역 변수가 정의되어 있음을 타입 스크립트에 알릴 때
            - 타입 스크립트로 직접 구현하지 않았지만 자바 스크립트 어딘가에 전역 변수가 정의되어 있는 상황을 타입 스크립트에 알릴 때
    - 앰비언트 타입 선언 시 주의점
        - 타입 스크립트로 만드는 라이브러리에 불필요
            - tsconfig.json의 declaration을 true로 설정하면 타입 스크립트 컴파일러가 .d.ts 파일을 자동으로 생성해주기 때문에 수동으로 작성할 필요가 없다.
        - 전역으로 타입을 정의하여 사용할 때 주의점
            - 서로 다른 라이브러리에서 동일한 이름의 앰비언트 타입 선언을 하면 충돌이 발생함
            - 명시적인 임포트, 익스포트가 없기 때문에 코드 의존성 관계가 명확하지 않아서 추후 변경하는데 어려울 수 있음
    - 앰비언트 타입 선언을 잘못했을 때 문제점
        - .ts 파일 내에 앰비언트 변수 선언하게 되면 의존성 관계가 보이지 않기 때문에 변경에 의한 영향 범위를 파악하기 어려움.
        - 앰비언트 타입은 명시적인 임포트, 익스포트 없이 코드 전역에서 사용할 수 있기 때문에 어느 곳에나 영향을 줄 수 있음
    - 앰비언트 타입 활용하기
        - 타입을 정의하여 임포트 없이 전역 공유
            - 앰비언트 타입으로 유틸리티 타입을 선언하면모든 코드에서 임포트하지 않아도 해당 타입 사용 가능
        - declare type 활용하기
            - 보편적으로 많이 사용하는 커스텀 유틸리티 타입을 declare type으로 선언하여 전역에서 사용 가능
        - declare module
            - 인터페이스 타입을 확장하여 타입이 자동으로 완성되도록 할 수 있음
            - 로컬 이미지나 SVG  같이 외부로 노출 되어있지 않은 파일을 모듈로 인식하여 사용 가능
        - declare namespace
            - Node.js 환경에서 .env 파일을 사용할 때 declare namespace를 활용하여 process.env로 설정값을 손쉽게 불러오고 환경변수의 자동 완성 기능을 쓸 수 있다.
        - declare global
            - 전역 변수를 선언할 때 사용
        
        (declare와 웹뷰 간의 관계? 사용법? 찾아보기)
        
    - declare와 번들러의 시너지
        - declare로 전역 변수를 선언하면 타입을 가지고 있는 객체의 실제 데이터가 존재하지는 않기 때문에 코드 실행시 기대하는 결과와 달라질 수 있다.
        - 이를 위해 번들 시점에 번들러를 통해 해당 데이터를 주입하는 방법이 있다.

## 12.2 스크립트와 설정 파일 활용하기

- 스크립트 활용하기
    - 실시간 타입 검사
        - 아래 스크립트를 통해 실시간으로 타입 에러를 확인할 수 있다.
        
        ```tsx
        yarn tsc -noEmit -incremental -w
        //noEmit : 자바 스크립트로 된 출력 파일을 생성하지 않는 옵션
        //incremental : 증분 컴파일을 활성화 하여 컴파일 시간을 단축
        //w : 파일 변경 사항 모니터링
        ```
        
        > ❓ 증분 컴파일
        매번 모든 대상을 컴파일 하는 것이 아니라 변경 사항이 있는 부분만을 컴파일 하는 것
        컴파일 시간을 줄일 수 있다.
        > 
    - 타입 커버리지 확인
        - 아래 스크립트를 통해 현재 프로젝트의 타입 커버리지와 any를 사용하고 있는 변수의 위치가 나타난다.
        
        ```tsx
        npx type-coverage -detail
        ```
        
        - 이를 통해 코드 리팩토링의 기반을 마련하는데 도움이 되는 정량적인 지표를 얻을 수 있다.
- 설정파일 활용하기
    - 타입 스크립트 컴파일 속도 높이기
        - tsconfig의 incremental 속성을 활용하여 타입 스크립트의 컴파일 속도를 높일 수 있다.
        - 증분 컴파일이 활성화 되어 매번 모든 대상을 컴파일 하는게 아닌 변경된 부분만 컴파일 하게 되기 때문이다.
- 에디터 활용하기
    - 에디터에서 타입 스크립트 서버 재시작하기
        - 정의된 타입이 있는 객체여도 임포트 되지 않거나 자동 완성 기능이 동작하지 않는 경우 타입 스크립트 서버를 재시작하자

## 12.3 타입 스크립트 마이그레이션

- 타입 스크립트를 새로운 기술 스택으로 정했어도 반드시 기존 프로젝트를 타입 스크립트로 마이그레이션 할 필요는 없다.
- 상황에 따라 비즈니스 요구 사항의 변화를 반영할 수 있는 새로운 설계를 기반으로 타입을 작성하는게 효율적일 수 있다.
- 점진적으로 타입 스크립트 마이그레이션을 진행하기로 결정했다면 우선 순위라도 정해서 빨리빨리 시작하자
- 마이그레이션을 진행하기로 했다면 다음과 같은 단계를 거치게 된다.
    1. 타입스크립트 개발 환경을 설정하고 , 빌드 파이프라인에 타입스크립트 컴파일러를 통합한다. tsconfig.json 파일에서 alLowJS를 true로 nolmplicitAny를 false로 설정해야 한다. alLowJS(기본값 : false)는 자바스크립트 파일을 컴파일할 때 사용하는 옵션으로 , 기존 자바스크립트 함수를 타입스크립트에서 임포트하거나 반대로 타입스크립트 함수를 자바스크립트에서 임포트할 수 있게 해준다. 또한 noImplicitAny는 암시적 any 타입이 있을 때 오류가 발생하게 하는 옵션이다. 따라서 타입을 점진적으로 추가하는 과정에서는 오류가 발생하지 않도록 noImplicitAny를 false로 설정해야 한다.
    2. 작성된 자바스크립트 파일을 타입스크립트 파일로 변환한다. 이 단계에서는 필요한 타입과 인터페이스를 하나씩 정의하며 함수 시그니처를 추가해나간다.
    3. 기존 자바스크립트 파일을 모두 타입스크립트로 변환하는 작업이 완료되었다면 tsconfig.json 파일에서 allowJS를 false로 변경하고 , noImplicitAny를 true로 설정하여 타입이 명시되지 않은 부분이 없는지 점검한다.

## 12.4 모노레포

- 분산된 구조의 경우 프로젝트에 필요한 기능이 다른 프로젝트에 존재한다면 해당 기능을 복사하여 붙여넣기 함으로써 빠르게 구현할 수 있다.
- 이런 과정을 통해 개발 시간을 아낄 수 있지만 프로젝트 관리 측면에서 모든 프로젝트에서 일일이 대응해야 하는 어려움이 생기기도 한다.
- 이는 장기적으로 프로젝트 관리가 어려워지며 업무 효율이 감소할 수 있다.
- 프로젝트 내에서 공통으로 통합할 수 있는 요소를 찾아 모듈화를 통해 통합하자.

> ❓모노레포
버전 관리 시스템에서 여러 프로젝트를 하나의 레포지토리로 통합하여 관리하는 소프트웨어 개발 전략
개발 환경 설정도 통합할 수 있어 효율적인 관리가 가능해진다.
장점
여러 프로젝트를 하나의 레포지토리로 통합하여 관리하기에 개발 환경 설정도 통합적으로 관리한다.
이는 불필요한 코드 중복을 줄여준다.
공통 모듈도 동일한 프로젝트 내에서 관리되므로 별도의 패키지 관리자를 통해 모듈을 게시하지 않아도 된다. 이로 인해 기능변화를 쉽게 추적하고 의존성을 관리할 수 있게 된다.

단점
시간이 지나면서 레포지토리가 거대해질 수 있다.
하나의 레포지토리에 여러 팀이 얽혀있다면 소유권과 권한 관리가 복잡해질 수 있다.
각 프로젝트나 모듈의 소유권을 명확히 정의하고 규칙을 설정해야 하는 과정이 별도로 필요하다.
>